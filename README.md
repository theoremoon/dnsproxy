# DNSProxy

これは何

なんか一時的に名前解決をhackしたいとき、ありますよね。サービス名のドメインを使いたいけど開発するときはそれはlocalhostに向いていてほしい、みたいな


そういうとき `/etc/hosts` を書き換えるというソリューションが知られているけど、恒常的に使う設定でも無ければあんまり触りたくないですよね。時々やらないといけないくて自動化したくなる。

そこでsedを持ち出すとちょっと不安だし、ansibleみたいなのを持ってくるのは大げさな気がする、世の中には `/etc/hosts`管理くんみたいなのもあるけど、別に`/etc/hosts` を管理したいわけじゃないんですよね

というわけで 

```
sudo ./dnsproxy example.com=localhost
```

とかして起動すると、`example.com`の名前解決結果を`localhost`に向けてくれる君です

何をしているかというと`nftables`を使って外向きの`53`番ポートへのアクセスをフックしています。`example.com`以外の名前解決には関心がないので`/etc/resolv.conf`に書いてあるDNS Serverに投げ直したかったけど、これはたいてい`53`番へのアクセスになってしまってこれもフックに引っかかるので、やむをえず`1.1.1.1:853`に*DNS over TLS*で名前解決を投げ直しています


便利だと思いませんか？　私はあんまり……。そもそも`nftables`使いたくなったからこんなことをしているけど、一時的に`/etc/hosts`を書き換えて、プロセスの終了とともにもとに戻してくれたらいいんですよね。

## Install

```
go install github.com/theoremoon/dnsproxy@latest
```

## Author

 theoremoon
